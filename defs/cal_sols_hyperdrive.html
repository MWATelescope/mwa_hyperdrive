<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js ayu">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>hyperdrive format - mwa_hyperdrive documentation</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="mwa_hyperdrive documentation">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "ayu";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('ayu')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../index.html">Introduction</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Installation</li><li class="chapter-item expanded "><a href="../installation/intro.html"><strong aria-hidden="true">1.</strong> How do I install hyperdrive?</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../installation/pre_compiled.html"><strong aria-hidden="true">1.1.</strong> Pre-compiled</a></li><li class="chapter-item "><a href="../installation/from_source.html"><strong aria-hidden="true">1.2.</strong> From source</a></li><li class="chapter-item "><a href="../installation/post.html"><strong aria-hidden="true">1.3.</strong> Post installation</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">User Guide</li><li class="chapter-item expanded "><a href="../user/intro.html"><strong aria-hidden="true">2.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../user/help.html"><strong aria-hidden="true">3.</strong> Getting started</a></li><li class="chapter-item expanded "><a href="../user/di_cal/intro.html"><strong aria-hidden="true">4.</strong> DI calibration</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../user/di_cal/tutorial.html"><strong aria-hidden="true">4.1.</strong> Tutorial</a></li><li class="chapter-item "><a href="../user/di_cal/simple.html"><strong aria-hidden="true">4.2.</strong> Simple usage</a></li><li class="chapter-item "><a href="../user/di_cal/out_calibrated.html"><strong aria-hidden="true">4.3.</strong> Getting calibrated data</a></li><li class="chapter-item "><div><strong aria-hidden="true">4.4.</strong> Advanced usage</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../user/di_cal/advanced/time_varying.html"><strong aria-hidden="true">4.4.1.</strong> Varying solutions over time</a></li></ol></li><li class="chapter-item "><a href="../user/di_cal/garrawarla.html"><strong aria-hidden="true">4.5.</strong> Usage on garrawarla</a></li></ol></li><li class="chapter-item expanded "><a href="../user/solutions_apply/intro.html"><strong aria-hidden="true">5.</strong> Apply solutions</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../user/solutions_apply/simple.html"><strong aria-hidden="true">5.1.</strong> Simple usage</a></li></ol></li><li class="chapter-item expanded "><a href="../user/vis_simulate/intro.html"><strong aria-hidden="true">6.</strong> Simulate visibilities</a></li><li class="chapter-item expanded "><a href="../user/vis_subtract/intro.html"><strong aria-hidden="true">7.</strong> Subtract visibilities</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><li class="part-title">Definitions and Concepts</li><li class="chapter-item expanded "><a href="../defs/pols.html"><strong aria-hidden="true">8.</strong> Polarisations</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">9.</strong> Supported visibility formats</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../defs/vis_formats_read.html"><strong aria-hidden="true">9.1.</strong> Read</a></li><li class="chapter-item "><a href="../defs/vis_formats_write.html"><strong aria-hidden="true">9.2.</strong> Write</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">10.</strong> MWA-specific details</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../defs/mwa/metafits.html"><strong aria-hidden="true">10.1.</strong> Metafits files</a></li><li class="chapter-item "><a href="../defs/mwa/delays.html"><strong aria-hidden="true">10.2.</strong> Dipole delays</a></li><li class="chapter-item "><a href="../defs/mwa/dead_dipoles.html"><strong aria-hidden="true">10.3.</strong> Dead dipoles</a></li><li class="chapter-item "><a href="../defs/mwa/mwaf.html"><strong aria-hidden="true">10.4.</strong> mwaf flag files</a></li><li class="chapter-item "><a href="../defs/mwa/corrections.html"><strong aria-hidden="true">10.5.</strong> Raw data corrections</a></li><li class="chapter-item "><a href="../defs/mwa/mwalib.html"><strong aria-hidden="true">10.6.</strong> mwalib</a></li></ol></li><li class="chapter-item expanded "><a href="../defs/beam.html"><strong aria-hidden="true">11.</strong> Beam responses</a></li><li class="chapter-item expanded "><a href="../defs/modelling/intro.html"><strong aria-hidden="true">12.</strong> Modelling visibilities</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../defs/modelling/rime.html"><strong aria-hidden="true">12.1.</strong> Measurement equation</a></li><li class="chapter-item "><a href="../defs/modelling/estimating.html"><strong aria-hidden="true">12.2.</strong> Estimating flux densities</a></li></ol></li><li class="chapter-item expanded "><a href="../defs/source_lists.html"><strong aria-hidden="true">13.</strong> Sky-model source lists</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../defs/fd_types.html"><strong aria-hidden="true">13.1.</strong> Flux-density types</a></li><li class="chapter-item "><a href="../defs/source_list_hyperdrive.html"><strong aria-hidden="true">13.2.</strong> hyperdrive format</a></li><li class="chapter-item "><a href="../defs/source_list_ao.html"><strong aria-hidden="true">13.3.</strong> André Offringa (ao) format</a></li><li class="chapter-item "><a href="../defs/source_list_rts.html"><strong aria-hidden="true">13.4.</strong> RTS format</a></li></ol></li><li class="chapter-item expanded "><a href="../defs/cal_sols.html"><strong aria-hidden="true">14.</strong> Calibration solutions file formats</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../defs/cal_sols_hyperdrive.html" class="active"><strong aria-hidden="true">14.1.</strong> hyperdrive format</a></li><li class="chapter-item "><a href="../defs/cal_sols_ao.html"><strong aria-hidden="true">14.2.</strong> André Offringa (ao) format</a></li><li class="chapter-item "><a href="../defs/cal_sols_rts.html"><strong aria-hidden="true">14.3.</strong> RTS format</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">15.</strong> Terminology</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../defs/blocks.html"><strong aria-hidden="true">15.1.</strong> Timeblocks and chanblocks</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><li class="part-title">Developer Guide</li><li class="chapter-item expanded "><a href="../dev/ndarray.html"><strong aria-hidden="true">16.</strong> Multiple-dimension arrays (ndarray)</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu (default)</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">mwa_hyperdrive documentation</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/MWATelescope/mwa_hyperdrive" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="the-hyperdrive-calibration-solutions-format"><a class="header" href="#the-hyperdrive-calibration-solutions-format">The <code>hyperdrive</code> calibration solutions format</a></h1>
<p>Jones matrices are stored in a <code>fits</code> file as an &quot;image&quot; with 4 dimensions
([timeblock][tile][chanblock][float]) in the &quot;SOLUTIONS&quot; HDU (which is the
second HDU). An element of the solutions is a 64-bit float (a.k.a.
double-precision float). The last dimension always has a length of 8; these
correspond to the real part of XX, the imaginary part of XX, then XY, YX and YY
(4 complex numbers to form a Jones matrix).</p>
<p>Tiles are ordered by antenna number, i.e. the second column in the observation's
corresponding metafits files labelled &quot;Antenna&quot;. Times and frequencies are
sorted ascendingly.</p>
<blockquote>
<p>Note that in the context of the MWA, &quot;antenna&quot; and &quot;tile&quot; are used
interchangeably.</p>
</blockquote>
<h2 id="metadata"><a class="header" href="#metadata">Metadata</a></h2>
<p>Many metadata keys are stored in HDU 1. All keys (in fact, all metadata) are
optional.</p>
<p><code>OBSID</code> describes the MWA observation ID, which is a GPS timestamp.</p>
<p><code>SOFTWARE</code> reports the software used to write this <code>fits</code> file.</p>
<h3 id="times"><a class="header" href="#times">Times</a></h3>
<p>Information on the calibration timeblocks is reported by the keys <code>S_TIMES</code>
(start times), <code>E_TIMES</code> (end times) and <code>A_TIMES</code> (average times). Each key is
a string with comma-separated GPS times. Each key is optional but ideally there
are as many GPS times for each key as there are calibration timeblocks.</p>
<p>While average times are likely just the values between each pair of start and
end times, it need not be so; in this case, it helps to clarify that some
timesteps in this calibration timeblock were not used.</p>
<h3 id="raw-mwa-data-corrections"><a class="header" href="#raw-mwa-data-corrections">Raw MWA data corrections</a></h3>
<p><code>PFB</code> describes the <a href="mwa/corrections.html#pfb-gains">PFB gains flavour</a> applied to
the raw MWA data. At the time of writing, this flavour is described as &quot;jake&quot;,
&quot;cotter2014&quot;, &quot;empirical&quot;, &quot;levine&quot;, or &quot;none&quot;.</p>
<p><code>D_GAINS</code> is &quot;Y&quot; if the <a href="../defs/mwa/corrections.html#digital-gains">digital
gains</a> were applied to the raw MWA
data. &quot;N&quot; if they were not.</p>
<p><code>CABLELEN</code> is &quot;Y&quot; if the <a href="../defs/mwa/corrections.html#cable-lengths">cable length
corrections</a> were applied to the raw
MWA data. &quot;N&quot; if they were not.</p>
<p><code>GEOMETRY</code> is &quot;Y&quot; if the <a href="../defs/mwa/corrections.html#geometric-correction-aka-phase-tracking">geometric delay
correction</a>
was applied to the raw MWA data. &quot;N&quot; if they were not.</p>
<h3 id="calibration-specific"><a class="header" href="#calibration-specific">Calibration-specific</a></h3>
<p><code>MAXITER</code> is the maximum number of iterations allowed for each chanblock's
convergence.</p>
<p><code>S_THRESH</code> is the stop threshold of calibration; chanblock iteration ceases once
its precision is better than this.</p>
<p><code>M_THRESH</code> is the minimum threshold of calibration; if a chanblock reaches the
maximum number of iterations while calibrating and this minimum threshold has
not been reached, we say that the chanblock failed to calibrate.</p>
<h2 id="extra-hdus"><a class="header" href="#extra-hdus">Extra HDUs</a></h2>
<p>More metadata are contained in HDUs other than the first one (that which
contains the metadata keys described above). Other than the first HDU and the
&quot;SOLUTIONS&quot; HDU (HDUs 1 and 2, respectfully), all HDUs are optional.</p>
<h3 id="tiles"><a class="header" href="#tiles">TILES</a></h3>
<p>The &quot;TILES&quot; HDU is a FITS table with three columns:</p>
<ol>
<li><code>Antenna</code></li>
<li><code>TileName</code></li>
<li><code>Flag</code></li>
</ol>
<p><code>Antenna</code> is the 0-N antenna index (where N is the total number of antennas in
the observation). These indices match the &quot;Antenna&quot; column of an <a href="mwa/metafits.html">MWA
metafits</a> file.</p>
<p><code>TileName</code> is the... name of the tile (a.k.a. antenna). As with <code>Antenna</code>, this
should match the contents of an MWA metafits file.</p>
<p><code>Flag</code> indicates whether an antenna was flagged during calibration (0) or used
(1).</p>
<h3 id="chanblocks"><a class="header" href="#chanblocks">CHANBLOCKS</a></h3>
<p>See <a href="blocks.html">blocks</a> for an explanation of what chanblocks are.</p>
<p>The &quot;CHANBLOCKS&quot; HDU is a FITS table with two columns:</p>
<ol>
<li><code>Index</code></li>
<li><code>Flag</code></li>
</ol>
<p><code>Index</code> is the 0-N chanblock index (where N is the total number of chanblocks in
the observation). Note that this is not necessarily the same as the total number
of <em>channels</em> in the observation; channels may be averaged before calibration,
making the number of chanblocks less than the number of channels.</p>
<p><code>Flag</code> indicates whether calibration was attempted (1) or not (2) on a
chanblock. These flags are needed to understand the &quot;RESULTS&quot; HDU.</p>
<h3 id="results-calibration-results"><a class="header" href="#results-calibration-results">RESULTS (Calibration results)</a></h3>
<p>The &quot;RESULTS&quot; HDU is a FITS image with two dimensions -- timeblock and
chanblock, in that order -- that describe the precision to which a chanblock
converged for that timeblock. Only the precisions of unflagged chanblocks are
included; the indices of unflagged chanblocks can be gleaned by the <code>Flag</code>
column of the chanblocks table (see &quot;CHANBLOCKS&quot; HDU above). NaN is listed for
chanblocks that completely failed to calibrate.</p>
<h3 id="baselines"><a class="header" href="#baselines">BASELINES</a></h3>
<p>The &quot;BASELINES&quot; HDU is a FITS image with one dimension. The values of the
&quot;image&quot; (let's call it an array) are the baseline weights used in calibration
(controlled by UVW minimum and maximum cutoffs). The length of the array is the
number of unflagged baselines. To determine which baseline corresponds to a
weight, you'll need to generate antenna pairs between unflagged tiles (e.g.
antenna 0 and 2 are flagged, baseline 0 is between antennas 1 and 3, baseline 1
is between antennas 1 and 4, etc. Therefore the first two baseline weights would
correspond to (1,3) and (1,4)).</p>
<h3 id="frequencies"><a class="header" href="#frequencies">Frequencies</a></h3>
<p>To be formalised!</p>
<h2 id="python-code-to-plot-solutions"><a class="header" href="#python-code-to-plot-solutions">Python code to plot solutions</a></h2>
<pre><code class="language-python">#!/usr/bin/env python

import sys
import numpy as np
from astropy.io import fits
import matplotlib.pyplot as plt

if len(sys.argv) == 1:
    filename = &quot;hyperdrive_solutions.fits&quot;
else:
    filename = sys.argv[1]

f = fits.open(filename)
data = f[1].data
num_tiles = data.shape[1]
num_tiles_per_row = num_tiles // 16

# Only looking at the first timeblock.
i_timeblock = 0
data = data[i_timeblock, :, :, ::2] + data[i_timeblock, :, :, 1::2] * 1j

# # Uncomment if you want to divide by a reference.
# i_tile_ref = -1
# refs = []
# for ref in data[i_tile_ref].reshape((-1, 2, 2)):
#     refs.append(np.linalg.inv(ref))
# refs = np.array(refs)
# j_div_ref = []
# for tile_j in data:
#     for (j, ref) in zip(tile_j, refs):
#         j_div_ref.append(j.reshape((2, 2)).dot(ref))
# data = np.array(j_div_ref).reshape(data.shape)

# Amps
amps = np.abs(data)

_, ax = plt.subplots(num_tiles_per_row, 16, sharex=True, sharey=True)
# Uncomment if you want to manually set the y-limit
# ax[0, 0].set_ylim(0, 2)
for i in range(num_tiles):
    ax[i // 16, i % 16].plot(amps[i, :, 0].flatten())  # XX
    ax[i // 16, i % 16].plot(amps[i, :, 3].flatten())  # YY
plt.show()

# Phases
phases = np.rad2deg(np.angle(data))

_, ax = plt.subplots(num_tiles_per_row, 16, sharex=True, sharey=True)
ax[0, 0].set_ylim(-180, 180)
for i in range(num_tiles):
    ax[i // 16, i % 16].plot(phases[i, :, 0].flatten())  # XX
    ax[i // 16, i % 16].plot(phases[i, :, 3].flatten())  # YY
plt.show()
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../defs/cal_sols.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../defs/cal_sols_ao.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../defs/cal_sols.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../defs/cal_sols_ao.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript" src="../mermaid.min.js"></script>
        <script type="text/javascript" src="../mermaid-init.js"></script>


    </body>
</html>
